<div class="ficha-militar-container">
  <form [formGroup]="fichaForm" class="ficha-militar-form" [ngClass]="'state-' + formState" (ngSubmit)="onSubmit()">

    <!-- Header Section -->
    <div class="form-header">

      <h2 class="form-title">{{ displayTitle }}</h2>

      <span class="state-indicator" [ngClass]="'state-' + formState">
        {{ getFormStateLabel() }}
      </span>

    </div>

    <!-- Action buttons section -->
    <div class="action-buttons-wrapper" style="display: flex; justify-content: flex-end; width: 100%;">
      <div class="action-buttons" style="margin-left: auto;">
        <button
          mat-raised-button type="button"
          class="action-button new-button"
          (click)="onNew()"
          [disabled]="formState === 'insert'"
          [style.visibility]="isNewButtonVisible() ? 'visible' : 'hidden'"
          matTooltip="Novo registro">
          <mat-icon>add</mat-icon>
          Novo
        </button>

        <button
          mat-raised-button type="button"
          class="action-button edit-button"
          (click)="onEdit()"
          [disabled]="formState === 'update' || !isDocumentLoaded"
          [style.visibility]="isEditButtonVisible() ? 'visible' : 'hidden'"
          matTooltip="Editar registro atual">
          <mat-icon>edit</mat-icon>
          Editar
        </button>

        <button
          mat-raised-button type="button"
          class="action-button cancel-button"
          (click)="onCancel()"
          [disabled]="formState === 'cancel'"
          [style.visibility]="isCancelButtonVisible() ? 'visible' : 'hidden'"
          matTooltip="Cancelar alterações">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>

        <button
          mat-raised-button
          type="submit"
          color="primary"
          class="action-button save-button"
          [disabled]="!canPerformActions() || fichaForm.invalid"
          [style.visibility]="isSaveButtonVisible() ? 'visible' : 'hidden'"
          matTooltip="Salvar alterações">
          <mat-icon>save</mat-icon>
          Salvar
        </button>
      </div>
    </div>

    <!-- Main Form Content -->
    <div class="form-content">

      <!-- Campos Principais (sempre visíveis) -->
      <div class="main-fields-section">
        <div class="section-header">
          <h3 class="section-title">
            <mat-icon>badge</mat-icon>
            Dados Principais
          </h3>
        </div>

        <div class="main-fields-grid">
          <!-- NIM - Campo col-sm-3 -->
          <div class="form-group field-nim">
            <mat-form-field appearance="outline">
              <mat-label>NIM</mat-label>
              <input matInput formControlName="nim" readonly [value]="formState === 'insert' ? 0 : fichaForm.get('nim')?.value">
              <button mat-icon-button matSuffix
                      class="search-button document-search"
                      (click)="onMilitarSearchClick('nim,nome,milstamp')"
                      type="button"
                      [disabled]="canPerformActions()"
                      matTooltip="Procurar por NIM">
                <mat-icon>search</mat-icon>
              </button>
               <mat-hint>Este campo é gerado automaticamente pelo sistema.</mat-hint>

             </mat-form-field>
          </div>

          <!-- Nome - Campo com maior espaço disponível -->
          <div class="form-group field-nome">
            <mat-form-field appearance="outline">
              <mat-label>Nome Completo</mat-label>
              <input matInput formControlName="nome" [disabled]="!canPerformActions()">
              <button mat-icon-button matSuffix
                      class="search-button document-search"
                      (click)="onMilitarSearchClick('nome,nim,milstamp')"
                      type="button"
                      [disabled]="canPerformActions()"
                      matTooltip="Procurar por Nome">
                <mat-icon>search</mat-icon>
              </button>
            </mat-form-field>
          </div>

          <!-- Situação - Campo col-sm-3 -->
          <div class="form-group field-situacao">
            <mat-form-field appearance="outline">
              <mat-label>Situação Atual</mat-label>
              <input matInput
                     formControlName="situacaoAtual"
                     readonly
                     placeholder="Carregada automaticamente da última situação">
              <mat-icon matSuffix>assignment_ind</mat-icon>
              <mat-hint>Situação militar atual (somente leitura)</mat-hint>
            </mat-form-field>
          </div>
        </div>
      </div>

      <mat-divider></mat-divider>

      <!-- Tab Group -->
      <mat-tab-group class="custom-tab-group" dynamicHeight>

        <mat-tab label="Dados gerais">

          <div class="tab-content">
          <mat-tab-group>
             <!-- Tab 1: Dados Pessoais -->
        <mat-tab label="Dados Pessoais">
          <div class="tab-content">
            <!-- Campo de busca por Nim ou Nome do militar -->

            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>person</mat-icon>
                Informações Pessoais
              </h3>
            </div>

            <div class="row">
              <!-- Coluna dos campos (col-sm-10) -->
              <div class="col-sm-10">
                <div class="form-grid">
                  <!-- Primeira linha: Data de Nascimento, Estado Civil, Sexo e Grupo Sanguíneo -->
                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Data de Nascimento</mat-label>
                      <input matInput [matDatepicker]="nascData" formControlName="nascData" [disabled]="!canPerformActions()">
                      <mat-datepicker-toggle matSuffix [for]="nascData" [disabled]="!canPerformActions()"></mat-datepicker-toggle>
                      <mat-datepicker #nascData [disabled]="!canPerformActions()"></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Estado Civil</mat-label>
                      <input matInput
                             formControlName="estCivil"
                             [disabled]="!canPerformActions()"
                             [matAutocomplete]="autoEstCivil"
                             placeholder="Digite para procurar...">
                      <mat-autocomplete #autoEstCivil="matAutocomplete"
                                        [displayWith]="displayFunction"
                                        (optionSelected)="onOptionSelected('estCivil', $event)">
                        <mat-option *ngFor="let estado of filteredEstCivil | async" [value]="estado">
                          {{estado}}
                        </mat-option>
                      </mat-autocomplete>
                      <button mat-icon-button matSuffix
                              type="button"
                              (click)="clearSelectionWithReset('estCivil', autoEstCivil)"
                              [disabled]="!canPerformActions() || !fichaForm.get('estCivil')?.value"
                              matTooltip="Limpar seleção">
                        <mat-icon>clear</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Sexo</mat-label>
                      <input matInput
                             formControlName="sexo"
                             [disabled]="!canPerformActions()"
                             [matAutocomplete]="autoSexo"
                             placeholder="Digite para procurar...">
                      <mat-autocomplete #autoSexo="matAutocomplete"
                                        [displayWith]="displayFunction"
                                        (optionSelected)="onOptionSelected('sexo', $event)">
                        <mat-option *ngFor="let sexo of filteredSexo | async" [value]="sexo">
                          {{sexo}}
                        </mat-option>
                      </mat-autocomplete>
                      <button mat-icon-button matSuffix
                              type="button"
                              (click)="clearSelectionWithReset('sexo', autoSexo)"
                              [disabled]="!canPerformActions() || !fichaForm.get('sexo')?.value"
                              matTooltip="Limpar seleção">
                        <mat-icon>clear</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Grupo Sanguíneo</mat-label>
                      <input matInput
                             formControlName="grupSangue"
                             [disabled]="!canPerformActions()"
                             [matAutocomplete]="autoGrupSangue"
                             placeholder="Digite para procurar...">
                      <mat-autocomplete #autoGrupSangue="matAutocomplete"
                                        [displayWith]="displayFunction"
                                        (optionSelected)="onOptionSelected('grupSangue', $event)">
                        <mat-option *ngFor="let grupo of filteredGrupSangue | async" [value]="grupo">
                          {{grupo}}
                        </mat-option>
                      </mat-autocomplete>
                      <button mat-icon-button matSuffix
                              type="button"
                              (click)="clearSelectionWithReset('grupSangue', autoGrupSangue)"
                              [disabled]="!canPerformActions() || !fichaForm.get('grupSangue')?.value"
                              matTooltip="Limpar seleção">
                        <mat-icon>clear</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>

                  <!-- Segunda linha: Nacionalidade e Cônjuge (ocupando toda a linha) -->
                  <div class="form-group form-group-half">
                    <mat-form-field appearance="outline">
                      <mat-label>Nacionalidade</mat-label>
                      <input matInput
                             formControlName="nacional"
                             [disabled]="!canPerformActions()"
                             [matAutocomplete]="autoNacionalidade"
                             placeholder="Digite para procurar...">
                      <mat-autocomplete #autoNacionalidade="matAutocomplete"
                                        [displayWith]="displayFunction"
                                        (optionSelected)="onOptionSelected('nacional', $event)">
                        <mat-option *ngFor="let nacionalidade of filteredNacionalidades | async" [value]="nacionalidade">
                          {{nacionalidade}}
                        </mat-option>
                      </mat-autocomplete>
                      <button mat-icon-button matSuffix
                              type="button"
                              (click)="clearSelectionWithReset('nacional', autoNacionalidade)"
                              [disabled]="!canPerformActions() || !fichaForm.get('nacional')?.value"
                              matTooltip="Limpar seleção">
                        <mat-icon>clear</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>

                  <div class="form-group form-group-half">
                    <mat-form-field appearance="outline">
                      <mat-label>Cônjuge</mat-label>
                      <input matInput formControlName="conjuge" [disabled]="!canPerformActions()">
                    </mat-form-field>
                  </div>

                  <!-- Terceira linha: Pai e Mãe (ocupando toda a linha) -->
                  <div class="form-group form-group-half">
                    <mat-form-field appearance="outline">
                      <mat-label>Pai</mat-label>
                      <input matInput formControlName="pai" [disabled]="!canPerformActions()">
                    </mat-form-field>
                  </div>

                  <div class="form-group form-group-half">
                    <mat-form-field appearance="outline">
                      <mat-label>Mãe</mat-label>
                      <input matInput formControlName="mae" [disabled]="!canPerformActions()">
                    </mat-form-field>
                  </div>

                  <!-- Quarta linha: Data de Casamento, Número de Filhos, Habilitações Literárias e Ramo -->
                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Data de Casamento</mat-label>
                      <input matInput [matDatepicker]="dataCasamento" formControlName="dataCasamento" [disabled]="!canPerformActions()">
                      <mat-datepicker-toggle matSuffix [for]="dataCasamento" [disabled]="!canPerformActions()"></mat-datepicker-toggle>
                      <mat-datepicker #dataCasamento [disabled]="!canPerformActions()"></mat-datepicker>
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <mat-form-field appearance="outline">
                      <mat-label>Número de Filhos</mat-label>
                      <input matInput formControlName="numFilhos" type="number" [disabled]="!canPerformActions()">
                    </mat-form-field>
                  </div>

                  <div class="form-group">
                    <mat-form-field appearance="outline" class="form-group-half">
                      <mat-label>Habilitações Literárias</mat-label>
                      <input matInput
                             formControlName="habiLite"
                             [disabled]="!canPerformActions()"
                             [matAutocomplete]="autoHabilitacoes"
                             placeholder="Digite para procurar...">
                      <mat-autocomplete #autoHabilitacoes="matAutocomplete"
                                        [displayWith]="displayFunction"
                                        (optionSelected)="onOptionSelected('habiLite', $event)">
                        <mat-option *ngFor="let hab of filteredHabilitacoes | async" [value]="hab">
                          {{hab}}
                        </mat-option>
                      </mat-autocomplete>
                      <button mat-icon-button matSuffix
                              type="button"
                              (click)="clearSelectionWithReset('habiLite', autoHabilitacoes)"
                              [disabled]="!canPerformActions() || !fichaForm.get('habiLite')?.value"
                              matTooltip="Limpar seleção">
                        <mat-icon>clear</mat-icon>
                      </button>
                    </mat-form-field>
                  </div>

                  <!-- ...outros campos... -->
                </div>
              </div>

              <!-- Coluna da foto (col-sm-2) -->
              <div class="col-sm-2">
                <div class="photo-section">
                  <h5 class="photo-title" style="text-align:center;font-weight:600;margin-bottom:12px;">Foto Militar</h5>
                  <div class="photo-container" style="display:flex;flex-direction:column;align-items:center;justify-content:center;background:#f7f9fc;border-radius:12px;padding:18px 10px;box-shadow:0 2px 8px rgba(0,0,0,0.07);border:1px solid #e0e4ea;min-height:240px;">
                    <img *ngIf="militarPhoto" [src]="militarPhoto" alt="Foto do Militar" style="max-width:120px;max-height:160px;border-radius:10px;border:2px solid #1976d2;box-shadow:0 2px 8px rgba(25,118,210,0.08);margin-bottom:10px;object-fit:cover;" />
                    <div *ngIf="!militarPhoto" style="color:#b0b5be;font-size:15px;padding:18px 0;text-align:center;">
                      <mat-icon style="font-size:38px;color:#b0b5be;">person</mat-icon><br>
                      Nenhuma foto carregada
                    </div>
                    <div style="margin-top:10px;display:flex;flex-direction:column;gap:8px;width:100%;align-items:center;">
                      <button mat-raised-button color="primary" type="button" (click)="openPhotoCapture()" [disabled]="!canPerformActions()" matTooltip="Capturar ou carregar foto" style="width:90%;min-width:120px;">
                        <mat-icon>photo_camera</mat-icon> <span style="margin-left:4px;">Capturar/Carregar Foto</span>
                      </button>
                      <button *ngIf="militarPhoto" mat-raised-button color="warn" type="button" (click)="removePhoto()" [disabled]="!canPerformActions()" matTooltip="Remover Foto" style="width:90%;min-width:120px;">
                        <mat-icon>delete</mat-icon> <span style="margin-left:4px;">Remover Foto</span>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 2: Dados de Nascimento -->
        <mat-tab label="Local de Nascimento">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>place</mat-icon>
                Informações de Nascimento
              </h3>
            </div>

            <div class="form-grid form-grid-three-columns">

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>País de Nascimento</mat-label>
                  <input matInput formControlName="nascPais"
                         [matAutocomplete]="autoPaisNasc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPaisNasc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPaisSelected($event.option.value, 'nasc')">
                    <mat-option *ngFor="let option of filteredPaisesNasc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('nascPais', 'nasc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar País">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Província de Nascimento</mat-label>
                  <input matInput formControlName="nascProv"
                         [matAutocomplete]="autoProvinciaNasc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoProvinciaNasc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onProvinciaSelected($event.option.value, 'nasc')">
                    <mat-option *ngFor="let option of filteredProvinciasNasc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('nascProv', 'nasc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Província">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Distrito de Nascimento</mat-label>
                  <input matInput formControlName="nascDist"
                         [matAutocomplete]="autoDistritoNasc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoDistritoNasc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onDistritoSelected($event.option.value, 'nasc')">
                    <mat-option *ngFor="let option of filteredDistritosNasc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('nascDist', 'nasc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Distrito">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Posto Administrativo de Nascimento</mat-label>
                  <input matInput formControlName="nascPosto"
                         [matAutocomplete]="autoPostoNasc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPostoNasc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPostoSelected($event.option.value, 'nasc')">
                    <mat-option *ngFor="let option of filteredPostosNasc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('nascPosto', 'nasc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Posto Administrativo">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Localidade de Nascimento</mat-label>
                  <input matInput formControlName="nascLocal"
                         [matAutocomplete]="autoLocalNasc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoLocalNasc="matAutocomplete"
                                    [displayWith]="displayFunction">
                    <mat-option *ngFor="let option of filteredLocalidadesNasc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('nascLocal', 'nasc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Localidade">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Povoação</mat-label>
                  <input matInput formControlName="nascPov" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 3: Documentos -->
        <mat-tab label="Documentos">
          <div class="tab-content">
  <div class="form-group field-nome">
           <mat-form-field appearance="outline">
  <mat-label>Procura Por BI</mat-label>
  <input matInput formControlName="procBi"
       [disabled]="!canPerformActions()">
    <button mat-icon-button matSuffix
            class="search-button document-search"
            (click)="onMilitarBiSearchClick('bi')"
            type="button"
            [disabled]="!fichaForm.get('procBi')?.value"
            matTooltip="Procurar por BI">
      <mat-icon>search</mat-icon>
    </button>
  </mat-form-field>
          </div>

            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>description</mat-icon>
                Documentos de Identificação
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarDocumento()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Documento
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="docDataSource" class="data-table">
                <!-- Tipo de Documento Column -->
                <ng-container matColumnDef="tipoDocumento">
                  <th mat-header-cell *matHeaderCellDef>Tipo de Documento</th>
                  <td mat-cell *matCellDef="let element">{{element.tipoDocumento}}</td>
                </ng-container>

                <!-- Número do Documento Column -->
                <ng-container matColumnDef="numeroDoc">
                  <th mat-header-cell *matHeaderCellDef>Número</th>
                  <td mat-cell *matCellDef="let element">{{element.numeroDoc}}</td>
                </ng-container>

                <!-- Local de Emissão Column -->
                <ng-container matColumnDef="localemissao">
                  <th mat-header-cell *matHeaderCellDef>Local de Emissão</th>
                  <td mat-cell *matCellDef="let element">{{element.localemissao}}</td>
                </ng-container>

                <!-- Data de Emissão Column -->
                <ng-container matColumnDef="dataemissao">
                  <th mat-header-cell *matHeaderCellDef>Data de Emissão</th>
                  <td mat-cell *matCellDef="let element">{{element.dataemissao | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Data de Validade Column -->
                <ng-container matColumnDef="datavalid">
                  <th mat-header-cell *matHeaderCellDef>Data de Validade</th>
                  <td mat-cell *matCellDef="let element">{{element.datavalid | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Actions Column -->
 <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button color="primary"  type="button"
                            (click)="editarDocumento(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button color="warn" type="button"
                            (click)="removerDocumento(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="docColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: docColumns; let i = index"
                    [class.selected]="selectedDocIndex === i"
                    (click)="selectDocumento(i)"></tr>

                <!-- <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="docColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: docColumns"></tr> -->



              </table>
            </div>
          </div>
        </mat-tab>

          </mat-tab-group>
</div>
        </mat-tab>

<mat-tab label="Dados Complementares">
<div class="tab-content">

        <mat-tab-group>
 <!-- Tab 5: Funções Desempenhadas -->
        <mat-tab label="Funções Desempenhadas">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>work</mat-icon>
                Funções Militares
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarFuncao()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Função
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="funcaoDataSource" class="data-table">
                <!-- Função Column -->
                <ng-container matColumnDef="funcao">
                  <th mat-header-cell *matHeaderCellDef>Função</th>
                  <td mat-cell *matCellDef="let element">{{element.funcao}}</td>
                </ng-container>

                <!-- orgao Column -->
                <ng-container matColumnDef="orgao">
                  <th mat-header-cell *matHeaderCellDef>Órgão</th>
                  <td mat-cell *matCellDef="let element">{{element.orgao}}</td>
                </ng-container>
                <!-- Unidade Column -->
                <ng-container matColumnDef="unidade">
                  <th mat-header-cell *matHeaderCellDef>Unidade</th>
                  <td mat-cell *matCellDef="let element">{{element.unidade}}</td>
                </ng-container>

                <!-- Data de Início Column -->
                <ng-container matColumnDef="dataInicio">
                  <th mat-header-cell *matHeaderCellDef>Data de Início</th>
                  <td mat-cell *matCellDef="let element">{{element.dataInicio | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Data de Fim Column -->
                <ng-container matColumnDef="dataTermino">
                  <th mat-header-cell *matHeaderCellDef>Data de Fim</th>
                  <td mat-cell *matCellDef="let element">{{element.dataTermino | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Observações Column -->
                <ng-container matColumnDef="obs">
                  <th mat-header-cell *matHeaderCellDef>Observações</th>
                  <td mat-cell *matCellDef="let element">{{element.obs}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editFuncao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerFuncao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="funcaoColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: funcaoColumns; let i = index"
                    [class.selected]="selectedFuncaoIndex === i"
                    (click)="selectFuncao(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>
          <!-- Tab 4: Dados de Residência -->
          <mat-tab label="Residência">
            <div class="tab-content">
              <div class="section-header">
                <h3 class="section-title">
                <mat-icon>home</mat-icon>
                Informações de Residência
              </h3>
            </div>

            <div class="form-grid">
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>País de Residência</mat-label>
                  <input matInput formControlName="resPais"
                         [matAutocomplete]="autoPaisRes"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPaisRes="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPaisSelected($event.option.value, 'res')">
                    <mat-option *ngFor="let option of filteredPaisesRes | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('resPais', 'res')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar País">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Província de Residência</mat-label>
                  <input matInput formControlName="resProv"
                         [matAutocomplete]="autoProvinciaRes"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoProvinciaRes="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onProvinciaSelected($event.option.value, 'res')">
                    <mat-option *ngFor="let option of filteredProvinciasRes | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('resProv', 'res')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Província">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Distrito de Residência</mat-label>
                  <input matInput formControlName="resDist"
                         [matAutocomplete]="autoDistritoRes"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoDistritoRes="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onDistritoSelected($event.option.value, 'res')">
                    <mat-option *ngFor="let option of filteredDistritosRes | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('resDist', 'res')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Distrito">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Posto Administrativo</mat-label>
                  <input matInput formControlName="resPosto"
                         [matAutocomplete]="autoPostoRes"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPostoRes="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPostoSelected($event.option.value, 'res')">
                    <mat-option *ngFor="let option of filteredPostosRes | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('resPosto', 'res')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Posto Administrativo">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Localidade</mat-label>
                  <input matInput formControlName="resLocalidade"
                         [matAutocomplete]="autoLocalRes"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoLocalRes="matAutocomplete"
                                    [displayWith]="displayFunction">
                    <mat-option *ngFor="let option of filteredLocalidadesRes | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('resLocalidade', 'res')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Localidade">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Bairro</mat-label>
                  <input matInput formControlName="resBairro" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Quarteirão</mat-label>
                  <input matInput formControlName="resQuarteirao" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Avenida/Rua</mat-label>
                  <input matInput formControlName="resAvenida" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Número da Casa</mat-label>
                  <input matInput formControlName="numCasa" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-tab>

 <!-- Tab 15: Línguas -->
        <mat-tab label="Línguas">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>translate</mat-icon>
                Conhecimento de Línguas
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarLingua()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Língua
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="linguaDataSource" class="data-table">
                <!-- Língua Column -->
                <ng-container matColumnDef="lingua">
                  <th mat-header-cell *matHeaderCellDef>Língua</th>
                  <td mat-cell *matCellDef="let element">{{element.lingua}}</td>
                </ng-container>

                <!-- Fala Column -->
                <ng-container matColumnDef="fala">
                  <th mat-header-cell *matHeaderCellDef>Fala</th>
                  <td mat-cell *matCellDef="let element">{{element.fala}}</td>
                </ng-container>

                <!-- Leitura Column -->
                <ng-container matColumnDef="leitura">
                  <th mat-header-cell *matHeaderCellDef>Leitura</th>
                  <td mat-cell *matCellDef="let element">{{element.leitura}}</td>
                </ng-container>

                <!-- Escrita Column -->
                <ng-container matColumnDef="escrita">
                  <th mat-header-cell *matHeaderCellDef>Escrita</th>
                  <td mat-cell *matCellDef="let element">{{element.escrita}}</td>
                </ng-container>

                <!-- Materna Column -->
                <ng-container matColumnDef="materna">
                  <th mat-header-cell *matHeaderCellDef>Materna</th>
                  <td mat-cell *matCellDef="let element">{{element.materna ? 'Sim' : 'Não'}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editLingua(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerLingua(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="linguaColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: linguaColumns; let i = index"
                    [class.selected]="selectedLinguaIndex === i"
                    (click)="selectLingua(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>

        </mat-tab-group>
        </div>
        </mat-tab>

        <mat-tab label="Incorporação">
<div class="tab-content">

          <mat-tab-group>
 <!-- Tab 6: Incorporação -->
        <mat-tab label="Incorporação">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>military_tech</mat-icon>
                Dados de Incorporação
              </h3>
            </div>

            <div class="form-grid form-grid-three-columns">
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>País de Incorporação</mat-label>
                  <input matInput formControlName="incPais"
                         [matAutocomplete]="autoPaisInc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPaisInc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPaisSelected($event.option.value, 'inc')">
                    <mat-option *ngFor="let option of filteredPaisesInc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('incPais', 'inc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar País">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Província de Incorporação</mat-label>
                  <input matInput formControlName="incProv"
                         [matAutocomplete]="autoProvinciaInc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoProvinciaInc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onProvinciaSelected($event.option.value, 'inc')">
                    <mat-option *ngFor="let option of filteredProvinciasInc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('incProv', 'inc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Província">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Distrito de Incorporação</mat-label>
                  <input matInput formControlName="incDist"
                         [matAutocomplete]="autoDistritoInc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoDistritoInc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onDistritoSelected($event.option.value, 'inc')">
                    <mat-option *ngFor="let option of filteredDistritosInc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('incDist', 'inc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Distrito">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Posto Administrativo</mat-label>
                  <input matInput formControlName="incPosto"
                         [matAutocomplete]="autoPostoInc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoPostoInc="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onPostoSelected($event.option.value, 'inc')">
                    <mat-option *ngFor="let option of filteredPostosInc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('incPosto', 'inc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Posto Administrativo">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Localidade</mat-label>
                  <input matInput formControlName="incLocal"
                         [matAutocomplete]="autoLocalInc"
                         [disabled]="!canPerformActions()">
                  <mat-autocomplete #autoLocalInc="matAutocomplete"
                                    [displayWith]="displayFunction">
                    <mat-option *ngFor="let option of filteredLocalidadesInc | async" [value]="option">
                      {{ option }}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          class="clear-button"
                          (click)="clearLocationSelection('incLocal', 'inc')"
                          type="button"
                          [disabled]="!canPerformActions()"
                          matTooltip="Limpar Localidade">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>

              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Data de Incorporação</mat-label>
                  <input matInput [matDatepicker]="incData" formControlName="incData" [disabled]="!canPerformActions()">
                  <mat-datepicker-toggle matSuffix [for]="incData" [disabled]="!canPerformActions()"></mat-datepicker-toggle>
                  <mat-datepicker #incData [disabled]="!canPerformActions()"></mat-datepicker>
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 7: Treino -->
        <mat-tab label="Treino">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>fitness_center</mat-icon>
                Informações de Treino
              </h3>
            </div>

            <div class="form-grid form-grid-three-columns">
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Início do Treino</mat-label>
                  <input matInput [matDatepicker]="inicioTreino" formControlName="inicioTreino" [disabled]="!canPerformActions()">
                  <mat-datepicker-toggle matSuffix [for]="inicioTreino" [disabled]="!canPerformActions()"></mat-datepicker-toggle>
                  <mat-datepicker #inicioTreino [disabled]="!canPerformActions()"></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Término do Treino</mat-label>
                  <input matInput [matDatepicker]="terminoTreino" formControlName="terminoTreino" [disabled]="!canPerformActions()">
                  <mat-datepicker-toggle matSuffix [for]="terminoTreino" [disabled]="!canPerformActions()"></mat-datepicker-toggle>
                  <mat-datepicker #terminoTreino [disabled]="!canPerformActions()"></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Duração do Treino</mat-label>
                  <input matInput formControlName="duracaoTreino" readonly placeholder="Ex: 3 meses">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Centro de Instrução Básica Militar</mat-label>
                  <input matInput
                         formControlName="centroTreino"
                         [disabled]="!canPerformActions()"
                         [matAutocomplete]="autoCentroTreino"
                         placeholder="Digite para procurar...">
                  <mat-autocomplete #autoCentroTreino="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onOptionSelected('centroTreino', $event)">
                    <mat-option *ngFor="let centro of filteredCentroTreino | async" [value]="centro">
                      {{centro}}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          type="button"
                          (click)="clearSelectionWithReset('centroTreino', autoCentroTreino)"
                          [disabled]="!canPerformActions() || !fichaForm.get('centroTreino')?.value"
                          matTooltip="Limpar seleção">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Designação do Curso</mat-label>
                  <input matInput
                         formControlName="cursoTreino"
                         [disabled]="!canPerformActions()"
                         [matAutocomplete]="autoCursoTreino"
                         placeholder="Digite para procurar...">
                  <mat-autocomplete #autoCursoTreino="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onOptionSelected('cursoTreino', $event)">
                    <mat-option *ngFor="let curso of filteredCursoTreino | async" [value]="curso">
                      {{curso}}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          type="button"
                          (click)="clearSelectionWithReset('cursoTreino', autoCursoTreino)"
                          [disabled]="!canPerformActions() || !fichaForm.get('cursoTreino')?.value"
                          matTooltip="Limpar seleção">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Ramo</mat-label>
                  <input matInput
                         formControlName="ramo"
                         [disabled]="!canPerformActions()"
                         [matAutocomplete]="autoRamos"
                         placeholder="Digite para procurar...">
                  <mat-autocomplete #autoRamos="matAutocomplete"
                                    [displayWith]="ramoDisplay"
                                    (optionSelected)="onOptionSelected('ramo', $event)">
                    <mat-option *ngFor="let ramo of filteredRamos | async" [value]="ramo?.descricao">
                      {{ramo?.descricao}}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          type="button"
                          (click)="clearSelectionWithReset('ramo', autoRamos)"
                          [disabled]="!canPerformActions() || !fichaForm.get('ramo')?.value"
                          matTooltip="Limpar seleção">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Especialidade</mat-label>
                  <input matInput
                         formControlName="adquirEspecial"
                         [disabled]="!canPerformActions()"
                         [matAutocomplete]="autoEspecialidade"
                         placeholder="Digite para procurar...">
                  <mat-autocomplete #autoEspecialidade="matAutocomplete"
                                    [displayWith]="displayFunction"
                                    (optionSelected)="onOptionSelected('especialidade', $event)">
                    <mat-option *ngFor="let especialidade of filteredEspecialidade | async" [value]="especialidade">
                      {{especialidade}}
                    </mat-option>
                  </mat-autocomplete>
                  <button mat-icon-button matSuffix
                          type="button"
                          (click)="clearSelectionWithReset('adquirEspecial', autoEspecialidade)"
                          [disabled]="!canPerformActions() || !fichaForm.get('adquirEspecial')?.value"
                          matTooltip="Limpar seleção">
                    <mat-icon>clear</mat-icon>
                  </button>
                </mat-form-field>
              </div>
            </div>
          </div>
        </mat-tab>

        </mat-tab-group>
</div>
  </mat-tab>

        <!-- Tab 8: Dados Médicos -->
        <mat-tab label="Dados Médicos">
          <div class="tab-content">
<mat-tab-group>
  <mat-tab label="Antropometria do Militar">
<div class="tab-content">
 <div class="section-header">
              <h3 class="section-title">
                <mat-icon>fitness_center</mat-icon>
                Antropometria do Militar
              </h3>
            </div>
 <div [formGroup]="milMedForm" class="milmed-fields-grid milmed-grid-4">
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Altura (cm)</mat-label>
                  <input matInput type="number" formControlName="altura" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Peso (kg)</mat-label>
                  <input matInput type="number" formControlName="peso" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Braço (cm)</mat-label>
                  <input matInput type="number" formControlName="braco" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Cabeça (cm)</mat-label>
                  <input matInput type="number" formControlName="cabeca" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Pescoco (cm)</mat-label>
                  <input matInput type="number" formControlName="pescoco" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Peito (cm)</mat-label>
                  <input matInput type="number" formControlName="peito" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Cintura (cm)</mat-label>
                  <input matInput type="number" formControlName="cintura" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Ancas (cm)</mat-label>
                  <input matInput type="number" formControlName="ancas" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Entrepernas (cm)</mat-label>
                  <input matInput type="number" formControlName="entrepernas" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Calçado (nº)</mat-label>
                  <input matInput type="number" formControlName="calcado" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>
              <div class="form-group">
                <mat-form-field appearance="outline">
                  <mat-label>Ombros (cm)</mat-label>
                  <input matInput type="number" formControlName="ombros" [disabled]="!canPerformActions()">
                </mat-form-field>
              </div>


            </div>
</div>

  </mat-tab>
  <mat-tab label="Saúde do Militar">
    <div class="tab-content">
        <div class="section-header">
              <h3 class="section-title">
                <mat-icon>medical_services</mat-icon>
                Saúde do Militar
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarSaude()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Registro
              </button>
            </div>
            <div class="table-container">
              <table mat-table [dataSource]="saDataSource" class="data-table">
                <!-- Doença Sofre Column -->
                <ng-container matColumnDef="doencaSofre">
                  <th mat-header-cell *matHeaderCellDef>Doença Sofre</th>
                  <td mat-cell *matCellDef="let element">{{element.doencaSofre}}</td>
                </ng-container>
                <!-- Doença Sofrida Column -->
                <ng-container matColumnDef="doencaSofrida">
                  <th mat-header-cell *matHeaderCellDef>Doença Sofrida</th>
                  <td mat-cell *matCellDef="let element">{{element.doencaSofrida}}</td>
                </ng-container>
                <!-- Cirurgia Sofrida Column -->
                <ng-container matColumnDef="cirurgiaSofrida">
                  <th mat-header-cell *matHeaderCellDef>Cirurgia Sofrida</th>
                  <td mat-cell *matCellDef="let element">{{element.cirurgiaSofrida}}</td>
                </ng-container>
                <!-- Motivo Doença Column -->
                <ng-container matColumnDef="motivoDoenca">
                  <th mat-header-cell *matHeaderCellDef>Motivo</th>
                  <td mat-cell *matCellDef="let element">{{element.motivoDoenca}}</td>
                </ng-container>
                <!-- Data Início Column -->
                <ng-container matColumnDef="datainicioDoenca">
                  <th mat-header-cell *matHeaderCellDef>Data Início</th>
                  <td mat-cell *matCellDef="let element">{{element.datainicioDoenca | date:'dd/MM/yyyy'}}</td>
                </ng-container>
                <!-- Observações Column -->
                <ng-container matColumnDef="obs">
                  <th mat-header-cell *matHeaderCellDef>Observações</th>
                  <td mat-cell *matCellDef="let element">{{element.obs}}</td>
                </ng-container>
                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editSaude(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerSaude(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="['doencaSofre','doencaSofrida','cirurgiaSofrida','motivoDoenca','datainicioDoenca','obs','actions']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['doencaSofre','doencaSofrida','cirurgiaSofrida','motivoDoenca','datainicioDoenca','obs','actions']; let i = index"
                    [class.selected]="selectedSaIndex === i"
                    (click)="selectSaude(i)"></tr>
              </table>
            </div>
          </div>
  </mat-tab>

  <mat-tab label="Situação de óbito">
    <div class="tab-content">
        <div class="section-header">
              <h3 class="section-title">
                <mat-icon color="warn">heart_broken</mat-icon>
                Situação de óbito
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarobito()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Registro
              </button>
            </div>
            <div class="table-container">
                <table mat-table [dataSource]="MilfaDataSource" class="data-table">
                <!-- Doença Sofre Column -->
                <ng-container matColumnDef="falecLocal">
                  <th mat-header-cell *matHeaderCellDef>Local do Falecimento</th>
                  <td mat-cell *matCellDef="let element">{{element.falecLocal}}</td>
                </ng-container>
                <!-- Doença Sofrida Column -->
                <ng-container matColumnDef="circunstancias">
                  <th mat-header-cell *matHeaderCellDef>circunstncias</th>
                  <td mat-cell *matCellDef="let element">{{element.circunstancias}}</td>
                </ng-container>
                <!-- Cirurgia Sofrida Column -->
                <ng-container matColumnDef="falecData">
                  <th mat-header-cell *matHeaderCellDef>Data do Falecimento</th>
                  <td mat-cell *matCellDef="let element">{{element.falecData | date:'dd/MM/yyyy'}}</td>
                </ng-container>
                <!-- Motivo Doença Column -->
                <ng-container matColumnDef="enterroData">
                  <th mat-header-cell *matHeaderCellDef>Data do enterro</th>
                  <td mat-cell *matCellDef="let element">{{element.enterroData | date:'dd/MM/yyyy'}}</td>
                </ng-container>
                <!-- Data Início Column -->
                <ng-container matColumnDef="numCampa">
                  <th mat-header-cell *matHeaderCellDef>Nº da campa</th>
                  <td mat-cell *matCellDef="let element">{{element.numCampa}}</td>
                </ng-container>
                <!-- Observações Column -->
                <ng-container matColumnDef="numCertObito">
                  <th mat-header-cell *matHeaderCellDef>Nº do Certificado de Óbito</th>
                  <td mat-cell *matCellDef="let element">{{element.numCertObito}}</td>
                </ng-container>
                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editMilfa(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerObito(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>
                <tr mat-header-row *matHeaderRowDef="['falecLocal','circunstancias','falecData','enterroData','numCampa','numCertObito','actions']"></tr>
                <tr mat-row *matRowDef="let row; columns: ['falecLocal','circunstancias','falecData','enterroData','numCampa','numCertObito','actions']; let i = index"
                    [class.selected]="selectedObitoIndex === i"
                    (click)="selectObito(i)"></tr>
              </table>

            </div>
          </div>
  </mat-tab>
</mat-tab-group>





          </div>

        </mat-tab>
<mat-tab label="Contactos">
<div class="tab-content">
  <mat-tab-group>
     <!-- Tab 10: Agregados Familiares -->
        <mat-tab label="Agregados Familiares">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>family_restroom</mat-icon>
                Agregados Familiares
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarAgregado()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Agregado
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="agreDataSource" class="data-table">
                <!-- Nome Column -->
                <ng-container matColumnDef="nome">
                  <th mat-header-cell *matHeaderCellDef>Nome</th>
                  <td mat-cell *matCellDef="let element">{{element.nome}}</td>
                </ng-container>

                <!-- Grau Column -->
                <ng-container matColumnDef="grau">
                  <th mat-header-cell *matHeaderCellDef>Grau</th>
                  <td mat-cell *matCellDef="let element">{{element.grau}}</td>
                </ng-container>

                <!-- Data Nascimento Column -->
                <ng-container matColumnDef="nascData">
                  <th mat-header-cell *matHeaderCellDef>Data de Nascimento</th>
                  <td mat-cell *matCellDef="let element">{{element.nascData | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Telefone Column -->
                <ng-container matColumnDef="telefone">
                  <th mat-header-cell *matHeaderCellDef>Telefone</th>
                  <td mat-cell *matCellDef="let element">{{element.telefone}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editAgregado(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerAgregado(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="agreColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: agreColumns; let i = index"
                    [class.selected]="selectedAgreIndex === i"
                    (click)="selectAgregado(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>
 <!-- Tab 12: Emails -->
        <mat-tab label="Emails">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>email</mat-icon>
                Endereços de Email
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarEmail()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Email
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="emailDataSource" class="data-table">
                <!-- Email Column -->
                <ng-container matColumnDef="email">
                  <th mat-header-cell *matHeaderCellDef>Email</th>
                  <td mat-cell *matCellDef="let element">{{element.email}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editEmail(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerEmail(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="emailColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: emailColumns; let i = index"
                    [class.selected]="selectedEmailIndex === i"
                    (click)="selectEmail(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>

        <!-- Tab 13: Telefones -->
        <mat-tab label="Telefones">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>phone</mat-icon>
                Números de Telefone
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarTelefone()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Telefone
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="telefoneDataSource" class="data-table">
                <!-- Número Column -->
                <ng-container matColumnDef="numero">
                  <th mat-header-cell *matHeaderCellDef>Número</th>
                  <td mat-cell *matCellDef="let element">{{element.numero}}</td>
                </ng-container>

                <!-- Tipo Column -->
                <ng-container matColumnDef="tipo">
                  <th mat-header-cell *matHeaderCellDef>Tipo</th>
                  <td mat-cell *matCellDef="let element">{{element.tipo}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editTelefone(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerTelefone(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="telefoneColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: telefoneColumns; let i = index"
                    [class.selected]="selectedTelefoneIndex === i"
                    (click)="selectTelefone(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>


  </mat-tab-group>
</div>
</mat-tab>


        <!-- Tab 11: Condecorações -->
       <mat-tab-group>
         <mat-tab label="Condecorações">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon color="accent">emoji_events</mat-icon>
                Condecorações e Galardões
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarCondecoracoes()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Condecoração
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="condeDataSource" class="data-table">
                <!-- Galardão Column -->
                <ng-container matColumnDef="galardoa">
                  <th mat-header-cell *matHeaderCellDef>Galardão</th>
                  <td mat-cell *matCellDef="let element">{{element.galardoa}}</td>
                </ng-container>

                <!-- Espécie Column -->
                <ng-container matColumnDef="especie">
                  <th mat-header-cell *matHeaderCellDef>Espécie</th>
                  <td mat-cell *matCellDef="let element">{{element.especie}}</td>
                </ng-container>

                <!-- Grau da Medalha Column -->
                <ng-container matColumnDef="grauMedalha">
                  <th mat-header-cell *matHeaderCellDef>Grau da Medalha</th>
                  <td mat-cell *matCellDef="let element">{{element.grauMedalha}}</td>
                </ng-container>

                <!-- Data de Galardoação Column -->
                <ng-container matColumnDef="dataGalardoacao">
                  <th mat-header-cell *matHeaderCellDef>Data de Galardoação</th>
                  <td mat-cell *matCellDef="let element">{{element.dataGalardoacao | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editCondecoracoes(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerCondecoracoes(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="condeColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: condeColumns; let i = index"
                    [class.selected]="selectedCondeIndex === i"
                    (click)="selectCondecoracoes(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>
         <mat-tab label="Recompensas">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>military_tech</mat-icon>
               Recompensas
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarCondecoracoes()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Condecoração
              </button>
            </div>

            <div class="table-container">

            </div>
          </div>
        </mat-tab>
         <mat-tab label="Licenças">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon color="primary">workspace_premium</mat-icon>
               Licenças
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarCondecoracoes()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Condecoração
              </button>
            </div>

            <div class="table-container">

            </div>
          </div>
        </mat-tab>
       </mat-tab-group>





<mat-tab-group>

        <!-- Tab 16: Situações -->
        <mat-tab label="Situações">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>assignment</mat-icon>
                Situações Militares
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="adicionarSituacao()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Situação
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="sitDataSource" class="data-table">
                <!-- Situação Column -->
                <ng-container matColumnDef="situacao">
                  <th mat-header-cell *matHeaderCellDef>Situação</th>
                  <td mat-cell *matCellDef="let element">{{element.situacao}}</td>
                </ng-container>

                <!-- Data OS Column -->
                <ng-container matColumnDef="dataOS">
                  <th mat-header-cell *matHeaderCellDef>Data OS</th>
                  <td mat-cell *matCellDef="let element">{{element.dataOS | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Número OS Column -->
                <ng-container matColumnDef="numOS">
                  <th mat-header-cell *matHeaderCellDef>Número OS</th>
                  <td mat-cell *matCellDef="let element">{{element.numOS}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editSituacao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerSituacao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="sitColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: sitColumns; let i = index"
                    [class.selected]="selectedSitIndex === i"
                    (click)="selectSituacao(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>

              <!-- Tab: Situação QP Ativo -->
              <mat-tab label="Situação QP Ativo">
                <div class="section-table">
                  <mat-card class="table-card">
                    <mat-card-content>
                      <!-- Situação QP Ativo content here -->
                    </mat-card-content>
                  </mat-card>
                </div>
              </mat-tab>

</mat-tab-group>
        <!-- Tab : Dados de carreira -->
        <mat-tab label="Dados de carreira">
          <div class="tab-content">
            <!-- Inner Tab Group -->
            <mat-tab-group class="inner-tab-group">
              <!-- Tab: Promoções -->
              <mat-tab label="Promoções">
                <div class="section-table">
                  <div class="section-header">
                    <h3 class="section-title">
                      <mat-icon>military_tech</mat-icon>
                      Promoções
                    </h3>
                    <button mat-raised-button color="primary"
                            type="button"
                            (click)="addProm()"
                            [disabled]="!canPerformActions()">
                      <mat-icon>add</mat-icon>
                      Adicionar Promoção
                    </button>
                  </div>
                  <mat-card class="table-card">
                    <mat-card-content>
                      <div class="table-container">
                        <table mat-table [dataSource]="promDataSource" class="mat-elevation-z2">
                          <ng-container matColumnDef="categoria">
                            <th mat-header-cell *matHeaderCellDef>Categoria</th>
                            <td mat-cell *matCellDef="let element">{{element.get('categoria').value}}</td>
                          </ng-container>

                          <ng-container matColumnDef="patente">
                            <th mat-header-cell *matHeaderCellDef>Patente</th>
                            <td mat-cell *matCellDef="let element">{{element.get('patente').value}}</td>
                          </ng-container>

                          <ng-container matColumnDef="tipoPromocao">
                            <th mat-header-cell *matHeaderCellDef>Tipo</th>
                            <td mat-cell *matCellDef="let element">{{element.get('tipoPromocao').value}}</td>
                          </ng-container>

                          <ng-container matColumnDef="dataOS">
                            <th mat-header-cell *matHeaderCellDef>Data OS</th>
                            <td mat-cell *matCellDef="let element">{{element.get('dataOS').value | date:'dd/MM/yyyy'}}</td>
                          </ng-container>

                          <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Ações</th>
                            <td mat-cell *matCellDef="let element; let i = index">
                              <button mat-icon-button type="button"
                               color="primary"
                                     (click)="editProm(element)"
                                     [disabled]="!canPerformActions()"
                                     matTooltip="Editar">
                                <mat-icon>edit</mat-icon>
                              </button>
                              <button mat-icon-button type="button"color="warn"
                                     (click)="deleteProm(element)"
                                     [disabled]="!canPerformActions()"
                                     matTooltip="Excluir">
                                <mat-icon>delete</mat-icon>
                              </button>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="promColumns"></tr>
                          <tr mat-row *matRowDef="let row; columns: promColumns;"></tr>
                        </table>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </div>
              </mat-tab>

              <!-- Tab: Registros -->
              <mat-tab label="Regime de prestação de serviço">
                <div class="section-table">
                  <div class="section-header">
                    <h3 class="section-title">
                      <mat-icon>assignment</mat-icon>
                      Regime de prestação de serviço
                    </h3>
                    <button mat-raised-button color="primary"
                            type="button"
                            (click)="addReg()"
                            [disabled]="!canPerformActions()">
                      <mat-icon>add</mat-icon>
                      Adicionar Registro
                    </button>
                  </div>
                  <mat-card class="table-card">
                    <mat-card-content>
                      <div class="table-container">
                        <table mat-table [dataSource]="regDataSource" class="mat-elevation-z2">
                          <ng-container matColumnDef="regime">
                            <th mat-header-cell *matHeaderCellDef>Regime</th>
                            <td mat-cell *matCellDef="let element">{{element.get('regime').value}}</td>
                          </ng-container>

                          <ng-container matColumnDef="dataReg">
                            <th mat-header-cell *matHeaderCellDef>Data do Registro</th>
                            <td mat-cell *matCellDef="let element">{{element.get('dataReg').value | date:'dd/MM/yyyy'}}</td>
                          </ng-container>

                          <ng-container matColumnDef="numOS">
                            <th mat-header-cell *matHeaderCellDef>Número OS</th>
                            <td mat-cell *matCellDef="let element">{{element.get('numOS').value}}</td>
                          </ng-container>

                          <ng-container matColumnDef="actions">
                            <th mat-header-cell *matHeaderCellDef>Ações</th>
                            <td mat-cell *matCellDef="let element; let i = index">
                              <button mat-icon-button type="button"color="primary"
                                     (click)="editReg(element)"
                                     [disabled]="!canPerformActions()"
                                     matTooltip="Editar">
                                <mat-icon>edit</mat-icon>
                              </button>
                              <button mat-icon-button type="button"color="warn"
                                     (click)="deleteReg(element)"
                                     [disabled]="!canPerformActions()"
                                     matTooltip="Excluir">
                                <mat-icon>delete</mat-icon>
                              </button>
                            </td>
                          </ng-container>

                          <tr mat-header-row *matHeaderRowDef="regColumns"></tr>
                          <tr mat-row *matRowDef="let row; columns: regColumns;"></tr>
                                               </table>
                      </div>
                    </mat-card-content>
                  </mat-card>
                </div>
              </mat-tab>

              <!-- Tab: Especialidades -->
              <mat-tab label="Especializações">
                <div class="section-table">
                  <div class="section-header">
                    <h2>Especializações do Militar</h2>
                    <button mat-raised-button color="primary" *ngIf="isEditing || formState"
                      (click)="addEspecial()">
                      <mat-icon>add</mat-icon>
                      Adicionar Especialidade
                    </button>
                  </div>

                  <div class="table-container mat-elevation-z2">
                    <table mat-table [dataSource]="especialDataSource" class="full-width-table">
                      <!-- Especialidade Column -->
                      <ng-container matColumnDef="especial">
                        <th mat-header-cell *matHeaderCellDef>Especialidade</th>
                        <td mat-cell *matCellDef="let element">{{ element.especial }}</td>
                      </ng-container>

                      <!-- Data Column -->
                      <ng-container matColumnDef="dataEspecial">
                        <th mat-header-cell *matHeaderCellDef>Data</th>
                        <td mat-cell *matCellDef="let element">{{ element.dataEspecial | date: 'dd/MM/yyyy' }}</td>
                      </ng-container>

                      <!-- NumOS Column -->
                      <ng-container matColumnDef="numOS">
                        <th mat-header-cell *matHeaderCellDef>Número OS</th>
                        <td mat-cell *matCellDef="let element">{{ element.numOS }}</td>
                      </ng-container>

                      <!-- Actions Column -->
                      <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef>Ações</th>
                        <td mat-cell *matCellDef="let element">
                          <button mat-icon-button type="button"color="primary" *ngIf="isEditing || formState"
                            (click)="editEspecial(element)" title="Editar">
                            <mat-icon>edit</mat-icon>
                          </button>
                          <button mat-icon-button type="button"color="warn" *ngIf="isEditing || formState"
                            (click)="deleteEspecial(element)" title="Excluir">
                            <mat-icon>delete</mat-icon>
                          </button>
                        </td>
                      </ng-container>

                      <tr mat-header-row *matHeaderRowDef="['especial', 'dataEspecial', 'numOS', 'actions']"></tr>
                      <tr mat-row *matRowDef="let row; columns: ['especial', 'dataEspecial', 'numOS', 'actions']"></tr>

                      <!-- Empty state row -->
                      <tr class="mat-row" *matNoDataRow>
                        <td class="mat-cell empty-table" colspan="4">
                          Nenhuma especialidade cadastrada
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>
              </mat-tab>
            </mat-tab-group>
          </div>
        </mat-tab>
        <!-- Tab 18: Situações do Militar -->
        <mat-tab label="Ocorrências do Militar">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>history</mat-icon>
               Ocorrências
              </h3>
            </div>

            <!-- Inner Tab Group for situações -->
            <mat-tab-group class="inner-tab-group">

               <mat-tab label="Formações concluídas">
          <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>school</mat-icon>
                Formações concluídas"
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="addFormacao()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar Formação
              </button>
            </div>

            <div class="table-container">
              <table mat-table [dataSource]="forDataSource" class="data-table">
                <!-- Curso Column -->
                <ng-container matColumnDef="curso">
                  <th mat-header-cell *matHeaderCellDef>Curso</th>
                  <td mat-cell *matCellDef="let element">{{element.curso}}</td>
                </ng-container>

                <!-- Instituição Column -->
                <ng-container matColumnDef="instituicao">
                  <th mat-header-cell *matHeaderCellDef>Instituição</th>
                  <td mat-cell *matCellDef="let element">{{element.instituicao}}</td>
                </ng-container>

                <!-- Data Início Column -->
                <ng-container matColumnDef="dataInicio">
                  <th mat-header-cell *matHeaderCellDef>Data Início</th>
                  <td mat-cell *matCellDef="let element">{{element.dataInicio | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Data Término Column -->
                <ng-container matColumnDef="dataTermino">
                  <th mat-header-cell *matHeaderCellDef>Data Término</th>
                  <td mat-cell *matCellDef="let element">{{element.dataTermino | date:'dd/MM/yyyy'}}</td>
                </ng-container>

                <!-- Actions Column -->
                <ng-container matColumnDef="actions">
                  <th mat-header-cell *matHeaderCellDef>Ações</th>
                  <td mat-cell *matCellDef="let element; let i = index">
                    <button mat-icon-button type="button"color="primary"
                            (click)="editFormacao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Editar">
                      <mat-icon>edit</mat-icon>
                    </button>
                    <button mat-icon-button type="button"color="warn"
                            (click)="removerFormacao(i)"
                            [disabled]="!canPerformActions()"
                            matTooltip="Excluir">
                      <mat-icon>delete</mat-icon>
                    </button>
                  </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="forColumns"></tr>
                <tr mat-row *matRowDef="let row; columns: forColumns; let i = index"
                    [class.selected]="selectedForIndex === i"
                    (click)="selectFormacao(i)"></tr>
              </table>
            </div>
          </div>
        </mat-tab>

              <!-- Tab: Situação Criminal -->
              <mat-tab label="Situação Criminal">
                <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>school</mat-icon>
               situações crimini
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="addSitCrim()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar situação criminal
              </button>
            </div>

            <div class="table-container">

<table mat-table [dataSource]="sitCrimDataSource" class="data-table">
  <!-- Órgão Column -->
  <ng-container matColumnDef="orgao">
    <th mat-header-cell *matHeaderCellDef>Órgão</th>
    <td mat-cell *matCellDef="let element">{{element.orgao}}</td>
  </ng-container>

  <!-- Infração Column -->
  <ng-container matColumnDef="infraccao">
    <th mat-header-cell *matHeaderCellDef>Infração</th>
    <td mat-cell *matCellDef="let element">{{element.infraccao}}</td>
  </ng-container>

  <!-- Número do Processo Column -->
  <ng-container matColumnDef="numProcesso">
    <th mat-header-cell *matHeaderCellDef>Nº Processo</th>
    <td mat-cell *matCellDef="let element">{{element.numProcesso}}</td>
  </ng-container>

  <!-- Data do Processo Column -->
  <ng-container matColumnDef="processodata">
    <th mat-header-cell *matHeaderCellDef>Data do Processo</th>
    <td mat-cell *matCellDef="let element">{{element.processodata | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Pena Column -->
  <ng-container matColumnDef="pena">
    <th mat-header-cell *matHeaderCellDef>Pena</th>
    <td mat-cell *matCellDef="let element">{{element.pena}}</td>
  </ng-container>

  <!-- Data de Detenção Column -->
  <ng-container matColumnDef="detencaoData">
    <th mat-header-cell *matHeaderCellDef>Data de Detenção</th>
    <td mat-cell *matCellDef="let element">{{element.detencaoData | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Data de Condenação Column -->
  <ng-container matColumnDef="condenacaoData">
    <th mat-header-cell *matHeaderCellDef>Data de Condenação</th>
    <td mat-cell *matCellDef="let element">{{element.condenacaoData | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Local da Prisão Column -->
  <ng-container matColumnDef="localPrisao">
    <th mat-header-cell *matHeaderCellDef>Local da Prisão</th>
    <td mat-cell *matCellDef="let element">{{element.localPrisao}}</td>
  </ng-container>

  <!-- Data de Soltura Column -->
  <ng-container matColumnDef="solturaData">
    <th mat-header-cell *matHeaderCellDef>Data de Soltura</th>
    <td mat-cell *matCellDef="let element">{{element.solturaData | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Nº do Documento de Soltura Column -->
  <ng-container matColumnDef="numDocSoltura">
    <th mat-header-cell *matHeaderCellDef>Nº Doc. Soltura</th>
    <td mat-cell *matCellDef="let element">{{element.numDocSoltura}}</td>
  </ng-container>

  <!-- Actions Column -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Ações</th>
    <td mat-cell *matCellDef="let element; let i = index">
      <button mat-icon-button type="button"color="primary"
              (click)="editSitCrim(i)"
              [disabled]="!canPerformActions()"
              matTooltip="Editar">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button type="button"color="warn"
              (click)="deleteSitCrim(i)"
              [disabled]="!canPerformActions()"
              matTooltip="Excluir">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['orgao','infraccao','numProcesso','processodata','pena','detencaoData','condenacaoData','localPrisao','solturaData','numDocSoltura','actions']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['orgao','infraccao','numProcesso','processodata','pena','detencaoData','condenacaoData','localPrisao','solturaData','numDocSoltura','actions']; let i = index"
      [class.selected]="selectedSitCrimIndex === i"
      (click)="selectSitCrim(i)"></tr>
</table>








            </div>
          </div>
              </mat-tab>

              <!-- Tab: Situação Disciplinar -->
              <mat-tab label="Situação Disciplinar">

                    <div class="tab-content">
            <div class="section-header">
              <h3 class="section-title">
                <mat-icon>school</mat-icon>
                situações disciplinares
              </h3>
              <button mat-raised-button color="primary"
                      type="button"
                      (click)="addSitDisc()"
                      [disabled]="!canPerformActions()">
                <mat-icon>add</mat-icon>
                Adicionar situação disciplinar
              </button>
            </div>

            <div class="table-container"><table mat-table [dataSource]="sitDiscDataSource" class="data-table">
  <!-- Órgão Column -->
  <ng-container matColumnDef="orgao">
    <th mat-header-cell *matHeaderCellDef>Órgão</th>
    <td mat-cell *matCellDef="let element">{{element.orgao}}</td>
  </ng-container>

  <!-- Nº OS Column -->
  <ng-container matColumnDef="numOS">
    <th mat-header-cell *matHeaderCellDef>Nº OS</th>
    <td mat-cell *matCellDef="let element">{{element.numOS}}</td>
  </ng-container>

  <!-- Infração Column -->
  <ng-container matColumnDef="infracao">
    <th mat-header-cell *matHeaderCellDef>Infração</th>
    <td mat-cell *matCellDef="let element">{{element.infracao}}</td>
  </ng-container>

  <!-- Nº Processo Column -->
  <ng-container matColumnDef="numProcesso">
    <th mat-header-cell *matHeaderCellDef>Nº Processo</th>
    <td mat-cell *matCellDef="let element">{{element.numProcesso}}</td>
  </ng-container>

  <!-- Data Processo Column -->
  <ng-container matColumnDef="dataProcesso">
    <th mat-header-cell *matHeaderCellDef>Data Processo</th>
    <td mat-cell *matCellDef="let element">{{element.dataProcesso | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Medidas Tomadas Column -->
  <ng-container matColumnDef="medTomadas">
    <th mat-header-cell *matHeaderCellDef>Medidas Tomadas</th>
    <td mat-cell *matCellDef="let element">{{element.medTomadas}}</td>
  </ng-container>

  <!-- Data Início Medida Column -->
  <ng-container matColumnDef="dataInicioMedida">
    <th mat-header-cell *matHeaderCellDef>Data Início Medida</th>
    <td mat-cell *matCellDef="let element">{{element.dataInicioMedida | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Data Término Medida Column -->
  <ng-container matColumnDef="dataTerminoMedida">
    <th mat-header-cell *matHeaderCellDef>Data Término Medida</th>
    <td mat-cell *matCellDef="let element">{{element.dataTerminoMedida | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Data Fim Medida Column -->
  <ng-container matColumnDef="dataFimMedida">
    <th mat-header-cell *matHeaderCellDef>Data Fim Medida</th>
    <td mat-cell *matCellDef="let element">{{element.dataFimMedida | date:'dd/MM/yyyy'}}</td>
  </ng-container>

  <!-- Local Column -->
  <ng-container matColumnDef="local">
    <th mat-header-cell *matHeaderCellDef>Local</th>
    <td mat-cell *matCellDef="let element">{{element.local}}</td>
  </ng-container>

  <!-- Actions Column -->
  <ng-container matColumnDef="actions">
    <th mat-header-cell *matHeaderCellDef>Ações</th>
    <td mat-cell *matCellDef="let element; let i = index">
      <button mat-icon-button type="button"color="primary"
              (click)="editSitDisc(i)"
              [disabled]="!canPerformActions()"
              matTooltip="Editar">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button type="button"color="warn"
              (click)="deleteSitDisc(i)"
              [disabled]="!canPerformActions()"
              matTooltip="Excluir">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="['orgao','numOS','infracao','numProcesso','dataProcesso','medTomadas','dataInicioMedida','dataTerminoMedida','dataFimMedida','local','actions']"></tr>
  <tr mat-row *matRowDef="let row; columns: ['orgao','numOS','infracao','numProcesso','dataProcesso','medTomadas','dataInicioMedida','dataTerminoMedida','dataFimMedida','local','actions']; let i = index"
      [class.selected]="selectedSitDiscIndex === i"
      (click)="selectSitDisc(i)"></tr>
</table>







            </div>
          </div>
              </mat-tab>

            </mat-tab-group>
          </div>
        </mat-tab>

      </mat-tab-group>
    </div>
  </form>
</div>
